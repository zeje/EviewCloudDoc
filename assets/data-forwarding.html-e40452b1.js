import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as a,f as e}from"./app-cbe19b05.js";const t={},o=e(`<h1 id="data-forwarding" tabindex="-1"><a class="header-anchor" href="#data-forwarding" aria-hidden="true">#</a> Data forwarding</h1><blockquote><p>platform provides a variety of data forwarding methods, <code>Open OpenAPI</code>, <code>Online subscription to websocket data</code>, and <code>MQTT subscription</code></p></blockquote><h2 id="use-websocket-to-subscribe-to-real-time-device-messages" tabindex="-1"><a class="header-anchor" href="#use-websocket-to-subscribe-to-real-time-device-messages" aria-hidden="true">#</a> Use Websocket to subscribe to real-time device messages</h2><p>You can subscribe to devices, device alarms and other related messages through websockets.</p><h3 id="interface" tabindex="-1"><a class="header-anchor" href="#interface" aria-hidden="true">#</a> interface</h3><div class="language-tip line-numbers-mode" data-ext="tip"><pre class="language-tip"><code>The websocket unified interface is: \`/messaging/{token}\`,
\`{token}\` can be accessed by logging into the system or using OpenAPI. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Take front-end js as an example:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:8844/messaging/a872d8e6cf6ccd38deb0c8772f6040e3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span>

If authentication fails<span class="token punctuation">,</span> the message <span class="token punctuation">{</span><span class="token string-property property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;authentication failed&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;authError&quot;</span><span class="token punctuation">}</span> is immediately returned<span class="token punctuation">,</span> and the connection is disconnected<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="subscribe-to-messages" tabindex="-1"><a class="header-anchor" href="#subscribe-to-messages" aria-hidden="true">#</a> Subscribe to messages</h3><p>Send a message to the websocket in the format:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub&quot;</span><span class="token punctuation">,</span> <span class="token comment">// fixed as sub</span>
    <span class="token string-property property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/device/*/*/**&quot;</span><span class="token punctuation">,</span> <span class="token comment">// topic, see topic list.</span>
    <span class="token string-property property">&quot;parameter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// parameter, different subscription requests, different supported parameters</span>
        
<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span> <span class="token comment">//request ID, the identity of the request, which the server will return when pushing the message.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">Note</p><p>Passing in the same id multiple times is invalid before canceling the subscription and the subscription will not be repeated.</p></div><p>Platform push message:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token comment">// message content, different topics, different content,</span>
    <span class="token string-property property">&quot;requestId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span><span class="token punctuation">,</span> <span class="token comment">// matches the id of the subscription request</span>
    <span class="token string-property property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/device/katch/123456789012345/offline&quot;</span><span class="token punctuation">,</span> <span class="token comment">//topic, the topic that actually generated the data</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;result&quot;</span> <span class="token comment">//type result: subscription result complete: end subscription error: error occurred </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">prompt</p><p>A complete type indicates that the subscription has ended, and is usually returned when subscribing to a limited stream of data (such as sending device instructions), or when unsubscribing.</p></div><h3 id="unsubscribe" tabindex="-1"><a class="header-anchor" href="#unsubscribe" aria-hidden="true">#</a> Unsubscribe</h3><p>Send a message to the websocket in the format:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;unsub&quot;</span><span class="token punctuation">,</span> <span class="token comment">// fixed as unsub</span>
     <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span> <span class="token comment">// Consistent with subscription request ID</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="subscribe-to-device-messages" tabindex="-1"><a class="header-anchor" href="#subscribe-to-device-messages" aria-hidden="true">#</a> Subscribe to device messages</h3><p>Consistent with the device topic in the message gateway, [View topic list] (.. /best-practices/start.md# device messages correspond to event bus topics).<br> The message payload (<code>payload</code>) is the same as the [device message type] (.. /best-practices/start.md# Platform Unified Device Message Definitions).</p><h3 id="send-device-instructions" tabindex="-1"><a class="header-anchor" href="#send-device-instructions" aria-hidden="true">#</a> Send device instructions</h3><p>Send a message to the websocket</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub&quot;</span><span class="token punctuation">,</span> <span class="token comment">// fixed as sub</span>
    <span class="token string-property property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/device-message-sender/katch/123456789012345,123456789012346&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Send messages to 123456789012345 and 123456789012346 devices under the katch model</span>
    <span class="token string-property property">&quot;parameter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        Message types<span class="token punctuation">,</span> <span class="token literal-property property">supported</span><span class="token operator">:</span> <span class="token constant">READ_PROPERTY</span> <span class="token punctuation">(</span>read properties<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">WRITE_PROPERTY</span> <span class="token punctuation">(</span>modify properties<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">INVOKE_FUNCTION</span> <span class="token punctuation">(</span>invoke <span class="token keyword">function</span><span class="token punctuation">)</span>
        <span class="token string-property property">&quot;messageType&quot;</span><span class="token operator">:</span><span class="token string">&quot;READ_PROPERTY&quot;</span> 
        Depending on the message<span class="token punctuation">,</span> the parameters are also different<span class="token punctuation">.</span> See<span class="token operator">:</span> Platform Unified Messaging Definitions
        <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Header information
        <span class="token string-property property">&quot;headers&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token string-property property">&quot;async&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// whether asynchronous, when asynchronous, the platform does not wait for the device to return the command result.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span> <span class="token comment">//request ID, the identity of the request, which the server will return when pushing the message.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The platform will push the results of the device back:</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//The result varies depending on the request message type</span>
        <span class="token property">&quot;deviceId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123456789012345&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;messageType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;READ_PROPERTY_REPLY&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// whether the instruction succeeded</span>
        <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;temperature&quot;</span><span class="token operator">:</span> <span class="token number">28.21</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">1588148129787</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;requestId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span><span class="token punctuation">,</span> <span class="token comment">//ID of the subscription request</span>
    <span class="token property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/device/katchu/123456789012345/offline&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;result&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">prompt</p><p><code>deviceId</code> supports <code>*</code> and comma <code>,</code> split, send messages to devices in batches. Such as: <code>/device-message-sender/{productId}/{deviceId}</code>.<br> If you want to terminate the sending, just cancel the subscription.</p></div><h3 id="batch-sync-device-status" tabindex="-1"><a class="header-anchor" href="#batch-sync-device-status" aria-hidden="true">#</a> Batch sync device status</h3><p>Send a message to the websocket</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub&quot;</span><span class="token punctuation">,</span> <span class="token comment">// fixed as sub</span>
    <span class="token string-property property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/device-batch/state-sync&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;parameter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;query&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;where&quot;</span><span class="token operator">:</span><span class="token string">&quot;productId is test-device&quot;</span><span class="token punctuation">}</span><span class="token comment">//Query condition is dynamic query condition</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span> <span class="token comment">//request ID, the identity of the request, which the server will return when pushing the message.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Platform push:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//The result varies depending on the request message type</span>
        <span class="token string-property property">&quot;deviceId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123456789012345&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;offline&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;offline&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;requestId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span><span class="token punctuation">,</span> <span class="token comment">//ID of the subscription request</span>
    <span class="token string-property property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/device-batch/state-sync&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;result&quot;</span> <span class="token comment">// for comlete means that the synchronization is complete.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="subscribe-to-device-alarm-data" tabindex="-1"><a class="header-anchor" href="#subscribe-to-device-alarm-data" aria-hidden="true">#</a> Subscribe to device alarm data</h3><p>Send a message to the websocket</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub&quot;</span><span class="token punctuation">,</span> <span class="token comment">// fixed as sub</span>
    <span class="token string-property property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/data-forwarding/device/alarm/{productId}/{deviceId}/{alarmId}&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;parameter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span> <span class="token comment">//request ID, the identity of the request, which the server will return when pushing the message.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Platform push:</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">//Alarm related data</span>
        <span class="token property">&quot;deviceId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Device ID&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;deviceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Device Name&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;alarmId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;alarm ID&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;alarmName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Alarm Name&quot;</span>
        <span class="token comment">//... Other alarm data</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;requestId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;request-id&quot;</span><span class="token punctuation">,</span> <span class="token comment">//ID of the subscription request</span>
    <span class="token property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/data-forwarding/device/alarm/{productId}/{deviceId}/{alarmId}&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;result&quot;</span> <span class="token comment">// for comlete means end of subscription.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="use-mqtt-to-subscribe-to-platform-messages" tabindex="-1"><a class="header-anchor" href="#use-mqtt-to-subscribe-to-platform-messages" aria-hidden="true">#</a> Use MQTT to subscribe to platform messages</h2><blockquote><p>TIP provides the function of subscribing to platform messages in MQTT. You can subscribe to devices, device alarms and other related messages through MQTT.</p></blockquote><h3 id="authentication" tabindex="-1"><a class="header-anchor" href="#authentication" aria-hidden="true">#</a> Authentication</h3><p>By default, <code>token</code> (you can use <code>OpenAPI</code> to apply for tokens) as <code>clientId</code>, <code>username</code> and <code>password</code> can be left unfilled in.</p><h3 id="subscribe-to-device-messages-1" tabindex="-1"><a class="header-anchor" href="#subscribe-to-device-messages-1" aria-hidden="true">#</a> Subscribe to device messages</h3><p>The following are common subscription topics:</p><ul><li><code>/device/*/*/message/event/trackerRealTime</code> real-time data</li><li><code>/device/*/*/message/event/trackerAlarm</code> alerts</li><li><code>/device/*/*/message/event/iccid</code> ICCID changes</li><li><code>/device/*/*/online</code> device is online</li><li><code>/device/*/*/offline</code> device is ideal</li><li><code>/_d_s/*/*/message/state/register</code> device enabled</li><li><code>/_d_s/*/*/message/state/unregister</code> device disabled</li><li><code>/_d_s/*/*/message/state/bind</code> devices are bound to the tenant</li><li><code>/_d_s/*/*/message/state/unbind</code> devices are untied from the tenant</li></ul>`,43),p=[o];function i(c,r){return n(),a("div",null,p)}const d=s(t,[["render",i],["__file","data-forwarding.html.vue"]]);export{d as default};
